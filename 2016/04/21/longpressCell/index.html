<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!--Description-->
    
        <meta name="description" content="&amp;gt;在文章的开头，感谢RayWanderlich和破船之家的教程使我自己对此功能有了了解

效果


实现首先在UITableView中创建一个Table view, 给tableview添加一个  UILongGestureRecognizer 可以在Tableview 的  viewDidL">
    

    <!--Author-->
    
        <meta name="author" content="Chaz">
    

    <!--Open Graph Title-->
    
        <meta property="og:title" content="Swift实现 利用长按手势移动(拖动) TableView Cell"/>
    

    <!--Open Graph Site Name-->
    <meta property="og:site_name" content="THE CHAZ BLOG"/>

    <!--Page Cover-->
    
        <meta property="og:image" content="undefined"/>
    

    <!-- Title -->
    
    <title>Swift实现 利用长按手势移动(拖动) TableView Cell - THE CHAZ BLOG</title>

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="/bootstrap/css/bootstrap.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/style.css">

    <!-- Custom Fonts -->
    <link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href='http://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- Gallery -->
    <link href="//cdn.rawgit.com/noelboss/featherlight/1.3.5/release/featherlight.min.css" type="text/css" rel="stylesheet" />

    <!-- Google Analytics -->
    


</head>

<body>

    <!-- Menu -->
    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">MENU</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                
                    <li>
                        <a href="/">Home</a>
                    </li>
                
                    <li>
                        <a href="/archives">Archives</a>
                    </li>
                
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>

    <!-- Main Content -->
    <!-- Page Header -->
<!-- Set your background image for this header in your post front-matter: cover -->

<header class="intro-header" style="background-image: url('http://ivansun123.b0.upaiyun.com/chaz/pic187.pic_hd.jpg!bac')">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <h1>Swift实现 利用长按手势移动(拖动) TableView Cell</h1>
                    
                    <span class="meta">
                        <!-- Date and Author -->
                        
                        2016-04-21
                    </span>
                </div>
            </div>
        </div>
    </div>
</header>

<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">

            <!-- Tags and categories -->
           
                <div class="col-lg-4 col-lg-offset-2 col-md-5 col-md-offset-1 post-tags">
                    
                        


<a href="/tags/UITableView/">#UITableView</a> <a href="/tags/ios/">#ios</a> <a href="/tags/swift/">#swift</a> <a href="/tags/UILongGestureRecognizer/">#UILongGestureRecognizer</a>


                    
                </div>
                <div class="col-lg-4 col-md-5 post-categories">
                    
                        

<a href="/categories/SWIFT/">SWIFT</a>

                    
                </div>
            

            <!-- Gallery -->
            

            <!-- Post Main Content -->
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <font size="2"><br>&gt;<strong>在文章的开头，感谢<a href="https://www.raywenderlich.com/63089/cookbook-moving-table-view-cells-with-a-long-press-gesture" target="_blank" rel="external">RayWanderlich</a>和<a href="http://beyondvincent.com/2014/03/26/2014-03-26-cookbook-moving-table-view-cells-with-a-long-press-gesture/" target="_blank" rel="external">破船之家</a>的教程使我自己对此功能有了了解</strong><br></font>

<h3 id="效果"><a href="#效果" class="headerlink" title="效果"></a>效果</h3><blockquote>
<p><img src="http://beyondvincent.com/images/2014/03/23.gif" alt=""></p>
</blockquote>
<h3 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h3><font color="gray">首先在UITableView中创建一个Table view, 给tableview添加一个  <span style="background:#D0D0D0">UILongGestureRecognizer </span>可以在Tableview 的  <span style="background:#D0D0D0">viewDidLoad</span> 方法中添加<br><br> <font size="2">override func viewDidLoad() {<br>        super.viewDidLoad()<br>        let longPress = UILongPressGestureRecognizer(target: self, action:selector(CHlongPressViewController.longPressGestureRecognized))<br>        tableView.addGestureRecognizer(longPress)<br>    }<br><br>&gt;这里longPressViewController是父ViewController</font>

<p>记得给gesture添加longpress的action方法，该方法首先利用<font color="#2828FF">.locationInView </font>方法获取pressgesture在tableview中的位置。特别需要注意的是：这里获取的<span style="background:#D0D0D0">index path </span>有可能为nil(例如长按header)</p>
<pre><code>   func longPressGestureRecognized(sender: AnyObject) {
let longPress = sender as! UILongPressGestureRecognizer
let state = longPress.state

let location = longPress.locationInView(tableView)
let indexPath = tableView.indexPathForRowAtPoint(location)
// More coming soon..
}     
</code></pre><blockquote>
<font size="2">后续需要接着在这个函数中，要继续处理Gesture各种State情况下触发的动作</font>


</blockquote>
<h3 id="手势Began"><a href="#手势Began" class="headerlink" title="手势Began"></a>手势Began</h3><p>接着需要处理UIGestureRecognizerStateBegan分支，如果此时花去的indexpath != <font color="red">nil </font>, 就去获取对应的UITableViewCell. 并利用ios7.0以后提供的UIView的一个方法<font color="blue">.snapshotViewAfterScreenUpdates(ture) </font>获取这个cell在当前视图上的截图，然后将这个截图添加到tableview中，并将其放到对应的cell上。</p>
<blockquote>
<font size="2">为了让cell移动起来跟更美妙、更像是cell从tableview中跳出来，浮在上面的效果。我们让snapshot view被选中的时候比原始的cell稍大一点，并将他的center.y坐标偏移量与手势的位置的Y轴对其</font>



</blockquote>
<pre><code>switch state {

case UIGestureRecognizerState.Began:
    guard let index = indexPath else { return }
    sourceIndexPath = indexPath
    let cell = tableView.cellForRowAtIndexPath(index) ?? UITableViewCell()

    snapShot = cell.snapshotViewAfterScreenUpdates(true)
    guard let snapshot = snapShot else { return }
    snapshot.layer.masksToBounds = false
    snapshot.layer.cornerRadius = 0.0
    snapshot.layer.shadowOffset = CGSizeMake(-5.0, 0.0)
    snapshot.layer.shadowRadius = 5.0
    snapshot.layer.shadowOpacity = 0.4

    var center = cell.center
    snapshot.center = center
    snapshot.alpha = 0
    tableView.addSubview(snapshot)

    UIView.animateWithDuration(0.25, animations: { 
        //offset for gesture location
        center.y = location.y
        snapshot.center = center
        snapshot.transform = CGAffineTransformMakeScale(1.05, 1.05)
        snapshot.alpha = 0.98

        cell.alpha = 0
        }, completion: { _ in
        // 当snapshot view悬浮起来，隐藏下面的cell
            cell.hidden = true
    })
    break
    //More coming soon..
  }
</code></pre><p>其中⬇️部分代码用于实现view -&gt; snapshot view</p>
<pre><code>snapShot = cell.snapshotViewAfterScreenUpdates(true)
       guard let snapshot = snapShot else { return }
       snapshot.layer.masksToBounds = false
       snapshot.layer.cornerRadius = 0.0
       snapshot.layer.shadowOffset = CGSizeMake(-5.0, 0.0)
       snapshot.layer.shadowRadius = 5.0
       snapshot.layer.shadowOpacity = 0.4
</code></pre><h3 id="手势changed"><a href="#手势changed" class="headerlink" title="手势changed"></a>手势changed</h3><p>当手势在tableview中移动的时候，也就是<span style="background:#D0D0D0">UILongGestureRecognizerStateChanged </span>分支，此时就要移动snapshot view,(原理就是移动snapshot view的y轴偏移量)，同时如果手势移动的距离跨到了另外一个indexpath, 就要告诉tableview, 让其移动rows，同时，再更新data source.</p>
<pre><code>    // ⬆️u    per code did&apos;t show
    case UIGestureRecognizerState.Changed:

        var center = snapshot.center
        center.y = location.y
        snapshot.center = center

        if !index.isEqual(sourceIndexPath) {
        //...update data source 
            data.exchangeObjectAtIndex(index.row, withObjectAtIndex: sourceIndex.row)

        //...move the rows
            tableView.moveRowAtIndexPath(sourceIndex, toIndexPath: index)

        //...and update source index path
            sourceIndexPath = index
        }
break
}
</code></pre><h3 id="手势End-cancel"><a href="#手势End-cancel" class="headerlink" title="手势End, cancel"></a>手势End, cancel</h3><p>最后，当手势结束或者取消时, tableview 和 data source 都是最新的，我们需要将snapshot view 从tableview 中移除，并将cell重新显示出来。</p>
<blockquote>
<font size="2">为了用户体验，我们将snapshot view淡出，并让其大小变为与cell一样，并将cell显示出来，这样看起来就像把cell放回去一样</font>

</blockquote>
<pre><code>default:
  let cell = tableView.cellForRowAtIndexPath(sourceIndex) ?? UITableViewCell()
  UIView.animateWithDuration(0.25, animations: { 
      snapshot.center = cell.center
      snapshot.transform = CGAffineTransformIdentity
      snapshot.alpha = 0
      cell.alpha = 1

      }, completion: { _ in
          cell.hidden = false
          snapshot.removeFromSuperview()
  })
</code></pre><p>就这样，利用长按手势移动TableView Cell就实现了. 你可以通过github下载到我的项目<a href="https://github.com/lukastong/ZTTableViewAnimateDemo" target="_blank" rel="external">下载到我的项目</a></p>
<hr>
<p><strong>*转载请注明出处</strong><br></p></font><p></p>

            </div>

            <!-- Comments -->
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                


            </div>
        </div>
    </div>
</article>

    <!-- Footer -->
    <hr />

<!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                    <li>
                        <a href="https://twitter.com/Chaz_Zhao" target="_blank">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    <li>
                        <a href="" target="_blank">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-facebook fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    <li>
                        <a href="https://github.com/klugjo/hexo-theme-clean-blog" target="_blank">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                </ul>
                <p class="copyright text-muted">Original Theme <a target="_blank" href="http://startbootstrap.com/template-overviews/clean-blog/">Clean Blog</a> from <a href="http://startbootstrap.com/" target="_blank">Start Bootstrap</a></p>
                <p class="copyright text-muted">Adapted for <a target="_blank" href="https://hexo.io/">Hexo</a> by <a href="http://www.codeblocq.com/" target="_blank">Jonathan Klughertz</a></p>
            </div>
        </div>
    </div>
</footer>


    <!-- After footer scripts -->
    
<!-- jQuery -->
<script src="/js/jquery.min.js"></script>

<!-- Bootstrap -->
<script src="/bootstrap/js/bootstrap.min.js"></script>

<!-- Gallery -->
<script src="//cdn.rawgit.com/noelboss/featherlight/1.3.5/release/featherlight.min.js" type="text/javascript" charset="utf-8"></script>

<!-- Disqus Comments -->


</body>

</html>